<!DOCTYPE html>
<html>
<head>
    <title>Global Search - Project Fetch</title>
    <style>
        :root { --primary: #3498db; --sidebar-bg: #2c3e50; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; padding: 40px; background: #f0f2f5; margin: 0; }
        .search-container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        input[type="text"] { width: 100%; padding: 15px; border-radius: 8px; border: 1px solid #ddd; font-size: 1.1em; margin-bottom: 20px; box-sizing: border-box; outline: none; }
        .result-card { border-bottom: 1px solid #eee; padding: 20px 0; display: flex; justify-content: space-between; align-items: flex-start; }
        
        /* Breadcrumb Styling */
        .breadcrumb-trail { font-size: 0.72em; color: #888; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
        .breadcrumb-trail a { color: var(--primary); text-decoration: none; font-weight: bold; }
        .breadcrumb-trail .separator { margin: 0 4px; opacity: 0.5; }

        .tag { font-size: 0.75em; background: #f8f9fa; padding: 4px 10px; border-radius: 4px; color: #666; border: 1px solid #eee; display: inline-block; margin-bottom: 5px; }
        .view-link { font-size: 0.85em; color: var(--primary); text-decoration: none; font-weight: bold; display: block; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="search-container">
        <a href="/bins/{{ return_to or 1 }}" style="text-decoration:none; color:var(--primary); font-weight: bold;">‚Üê Back to Dashboard</a>
        <h2 style="margin-top:20px; color: var(--sidebar-bg);">üîç Global Inventory Search</h2>

        <form action="/global-search" method="get">
            <input type="hidden" name="return_to" value="{{ return_to }}">
            <input type="text" name="q" value="{{ query or '' }}" placeholder="Search all households, bins, and descriptions..." autofocus>
        </form>

        {% if results %}
            <p style="color:#666;">Found <strong>{{ results|length }}</strong> results for "{{ query }}":</p>
            {% for item in results %}
                <div class="result-card">
                    <div style="flex-grow: 1; padding-right: 20px;">
                        {% if item.path %}
                        <div class="breadcrumb-trail">
                            {% for step in item.path %}
                                <a href="/bins/{{ item.household_id }}#bin-{{ step.id }}">{{ step.name }}</a>
                                <span class="separator">&gt;</span>
                            {% endfor %}
                        </div>
                        {% endif %}

                        <strong style="font-size:1.2em; color: #333;">{{ item.name }}</strong><br>
                        <span style="color:#666; font-size:0.95em;">{{ item.description or 'No description' }}</span>
                    </div>

                    <div style="text-align:right; min-width: 180px;">
                        <span class="tag">üè† {{ item.household_name }}</span><br>
                        <span class="tag">üì¶ {{ item.bin_name }}</span>
                        
                        {# Use household_id from the result to ensure the link works across all areas #}
                        <a href="/bins/{{ item.household_id }}#bin-{{ item.bin_id or item.id }}" class="view-link">
                            View in {{ item.household_name }} ‚Üí
                        </a>
                    </div>
                </div>
            {% endfor %}
        {% elif query %}
            <p>No items found matching "<strong>{{ query }}</strong>".</p>
        {% endif %}
        <footer style="margin-top: 50px; padding: 20px; text-align: center; border-top: 1px solid #ddd; color: #888; font-size: 0.8em;">
            Project Fetch Version: <strong style="color: var(--primary);">{{ version }}</strong>
        </footer>
    </div>
</body>
</html>
